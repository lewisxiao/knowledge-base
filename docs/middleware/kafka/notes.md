# 消费者
kafka 主题中的消息可以被多个应用程序消费，那么如何实现这个呢？那就需要通过为不同的应用程序设置不同的消费者组，好的实践是为每一个消费者都设置消费者组。

同一消费这组中的消费者只能消费固定分区中的消息，如果消费者数量大于主题中的分区数量，那么就会存在消费者空闲，什么也不干，为了避免这种资源浪费，消费者的数量不能大于分区的数量。

## 提交和偏移量
kafka有多种提交偏移量的方式：
* 自动提交
> 出现重复消费

* 手动提交当前偏移量
> 在遇到无法恢复的错误之前，一直重试
> 出现重复消费
> 丢失消息

* 异步提交
> 不会重试

* 同步和异步组合提交

## 反序列化器

# 控制器 - broker
控制器就是一个broker，集群里第一个启动的broker就自动成为了控制器，它除了具有一般broker的功能外，还负责分区首领的选举。

# 复制（副本）
试想一下这种情况，当某个节点因为故障不可用，导致你的业务受影响，轻则损失一定财产，然而企业的信誉受损是难以挽回的。复制作为 kafka 的核心，可以允许在部分节点失效时，仍能提供服务，这就是 kafka 的高可用性。

kafka 使用主题来组织数据，每个主题被分为若干个分区，每个分区有多个副本。副本都被保存在 broker 上，每个 broker 可以保存成百上千个属于不同主题分区的副本。

## 副本的分类：首领副本和跟随着副本
首领副本：每个分区都有一个首领副本，所有的生产者请求、消费者请求都会经过这个副本

跟随着副本：首领副本以外的都是跟随着副本，跟随者副本不处理来自客户端的请求，它们唯一的任务就是从首领那里复制消息，保持与首领一致的状态。如果首领发生崩溃，其中一个跟随者会被提升为新首领。

# 请求类型
* 元数据请求
* 生产请求
* 获取请求


# FAQ
## 1. kafka中在什么情况下会出现消息重复消费？不消费（错过消费）？如何避免？

## 2. kafka的数据会保留多久？
数据保留多久，是指主题中的数据能保留多久，从两个维度去看：1. 保留多长时间；2.保留的数据量大小