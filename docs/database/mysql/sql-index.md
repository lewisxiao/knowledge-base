## 定义
索引在MySQL中也叫“键”，其存储的值也叫做“键值”，是存储引擎为了**快速找到记录的一种数据结构**。


## 算法和数据结构
### 二分查找法
二分查找法也叫折半查找法，用来查找一组有序数据中的某一项记录。基本思想：先将一组数据有序（升序或降序）排列，先以中点位置为比较对象，如果要找的元素小于中点位置的元素，则将序列缩小为左半部分，否则为右半部分。通过一次比较将查找区间缩小为一半。

> 在B+树索引中，B+树索引只能找到某条记录所在的页，需再根据二分查找法来进一步找到记录所在具体页的位置。

### 二叉查找树
二叉查找树由二叉树演化而来。在二叉查找树中，左子树的键值总是小于根的键值，右子树的键值总是大于根的键值。可以通过中序遍历得到键值的排序输出。

二叉查找树可以任意构造，有时候查找效率、性能都会很差。为了解决这个问题，于是就引入了平衡二叉树。

### 平衡二叉树
平衡二叉树（英文叫AVL），首先要符合二叉查找树的定义，其次必须满足任何节点的两棵子树的高度最大差为1。

平衡二叉树在查找方面的性能是比较高的，但不是最高的，只是接近最高性能。要达到最佳性能需要构建一个最优二叉树，但是最优二叉树的建立和维护需要大量的操作，得不偿失，因此一般只需要建立一个平衡二叉树即可。

平衡二叉树已经够快了，但是维护一棵平衡二叉树的代价非常高，当有新增、删除节点时，需要经过一次或者多次的左旋、右旋来保持树的平衡。

### B+树
B+树是通过二叉查找树，再由平衡二叉树、B树演化而来。B+树是为磁盘或其他直接存取辅助设备设计的一种平衡查找树，在B+树中，所有记录的节点都按键值的大小顺序放在同一层的叶子节点中，各叶子节点通过指针进行链接。而MySQL的索引实现算法采用的就是B+树。

> 知识拓展：B树、B+树有什么不同点？

## 索引
索引在书面上有很多叫法，这些概念也是需要逐个弄清楚的。严格来说，索引只分为两大类：聚集索引和辅助索引。按从不同的角度，索引也有其他的分类。

```
1. 数据结构角度
  * B+树索引
  * Hash索引

2. 物理存储的角度
  * 聚集索引（聚簇索引）
  * 二级索引（辅助索引、非聚集索引、非聚簇索引）

3. 索引字段特性角度
  * 主键索引
  * 唯一索引
  * 普通索引
  * 前缀索引

4. 索引字段个数角度
  * 单列索引
  * 联合索引（复合索引）

覆盖索引：从索引中就可以得到查询的记录，而不需要查询聚集索引中的记录。该索引不会包含整行的记录信息，其大小要远远小于聚集索引，可以减少大量的IO操作。
```

## 创建正确的索引
### 前缀索引索引选择性
索引的选择性指不重复的索引值（也称为基数，cardinality）和数据库表的记录总数的比值。越接近1，则索引选择性越高，索引的效率也就越高。唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。

执行命令`SHOW INDEX FROM表名`，返回结果中，有一列Cardinality，表示索引中唯一只记录数量的预估值，**Cardinality / 表的总行数**应尽可能接近1。但需要注意：Cardinality只是一个预估值，不是准确值。

为了更精准的计算出索引的选择性，可以用这个等式：**count(distinct left(列名, 索引长度))/count(*)的区分度来确定**。这种计算出来的是平均选择性，如果数据的分布很不均匀，就会有问题。


## 索引情况分析
### 有效查询
1. 全值匹配：索引中的全部列进行匹配
2. 匹配最左前缀：以列为单位，匹配索引的第一列、第一列和第二列，以此类推
3. 匹配列前缀：匹配索引某一列值的开头部分
4. 匹配范围值
5. 精确匹配某一列并范围匹配另一列
6. 只访问索引的查询


## 索引文件